<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Chat - Public Only</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Stylesheet (for fixed layout and scrolling) -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase v8 CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body class="bg-gray-100 chat-app-container">

    <!-- Main Header (Fixed at top) -->
    <header class="bg-white shadow-md p-3 flex justify-between items-center sticky top-0 z-20">
        
        <!-- LEFT SIDE - PROFILE -->
        <div class="flex items-center">
            <button id="profileBtn" class="p-2 rounded-full hover:bg-gray-200 focus:outline-none disabled:opacity-50" disabled>
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </button>
        </div>

        <!-- CENTER - DISPLAY CURRENT ROOM NAME -->
        <div class="flex-1 text-center font-bold text-lg text-gray-800 truncate" id="currentRoomDisplay">
            General Chat
        </div>

        <!-- RIGHT SIDE - MENU / GROUPS -->
        <div class="relative">
            <button id="menuBtn" class="p-2 rounded-full hover:bg-gray-200 focus:outline-none disabled:opacity-50" disabled>
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            
            <!-- Group Menu Panel -->
            <div id="groupMenuPanel" class="absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-xl z-30 hidden">
                <div class="p-3 border-b font-semibold text-gray-700">Public Groups</div>
                <div id="publicRoomsList" class="p-2">
                    <!-- Public groups list -->
                </div>
                 <div class="p-3 text-xs text-gray-500 border-t">
                    Private DMs are disabled.
                </div>
            </div>
        </div>
    </header>

    <!-- Chat Content Area (Scrollable, now reversed for bottom-up flow) -->
    <div id="chatContainer" class="chat-scroll-area p-4 bg-gray-50 flex flex-col-reverse">
        <div class="text-center text-gray-500 pt-10">Please sign in to start chatting.</div>
    </div>

    <!-- Typing Indicator (Fixed just above input) -->
    <div id="typingIndicator" class="z-10 p-2 text-sm text-gray-500 bg-white border-t hidden w-full">
    </div>

    <!-- Message Input (Fixed at the absolute bottom) -->
    <div class="bg-white p-4 border-t shadow-inner sticky bottom-0 z-10">
        <div id="messageFormContainer" class="flex space-x-2 hidden">
            <input type="text" id="messageInput" placeholder="Type a message..." class="flex-1 p-3 border border-gray-300 rounded-full focus:ring-blue-500 focus:border-blue-500">
            <button id="sendBtn" class="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600 transition duration-150 disabled:bg-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            </button>
        </div>
    </div>
    
    <!-- Authentication Modal (Signup/Login) -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center transition-opacity duration-300">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-sm shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 text-center" id="authTitle">Sign Up</h3>
            
            <div id="authError" class="text-red-600 text-sm mb-3 hidden"></div>

            <div class="space-y-4">
                <!-- Username -->
                <div id="usernameField">
                    <label for="authUsername" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="authUsername" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Unique Username">
                </div>

                <!-- First Name -->
                <div id="firstNameField">
                    <label for="authFirstName" class="block text-sm font-medium text-gray-700">First Name</label>
                    <input type="text" id="authFirstName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="First Name">
                </div>
                
                <!-- Last Name -->
                <div id="lastNameField">
                    <label for="authLastName" class="block text-sm font-medium text-gray-700">Last Name</label>
                    <input type="text" id="authLastName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Last Name">
                </div>

                <!-- Email -->
                <div>
                    <label for="authEmail" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="authEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="your@email.com">
                </div>

                <!-- Password -->
                <div>
                    <label for="authPassword" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="authPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="min 6 characters">
                </div>

                <button id="authSubmitBtn" class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition duration-150">Sign Up</button>
            </div>
            
            <div class="mt-4 text-center">
                <button id="toggleAuthMode" class="text-sm text-blue-500 hover:text-blue-700 focus:outline-none">Already have an account? Log In</button>
            </div>
        </div>
    </div>


    <!-- Profile Modal (Full Overlay) -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center hidden transition-opacity duration-300">
        <div class="bg-white rounded-xl p-6 w-11/12 max-w-md shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 border-b pb-2">Your Profile</h3>
            
            <div class="space-y-4">
                
                <!-- Full Name Display -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Full Name</label>
                    <p class="text-lg font-semibold" id="profileFullName"></p>
                </div>

                <!-- Email Display -->
                <div class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <p class="text-md font-medium" id="profileEmail"></p>
                </div>
                
                <!-- Editable Username -->
                <div>
                    <label for="profileUsernameInput" class="block text-sm font-medium text-gray-700">Username</label>
                    <div class="flex mt-1">
                        <input type="text" id="profileUsernameInput" class="flex-1 p-2 border border-gray-300 rounded-l-lg focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100" placeholder="Enter new username">
                        <button id="updateUsernameBtn" class="bg-green-500 text-white p-2 rounded-r-lg hover:bg-green-600 disabled:bg-gray-400">Update</button>
                    </div>
                    <p id="usernameStatus" class="mt-1 text-xs text-red-500"></p>
                </div>

                <!-- UID -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">UID</label>
                    <div class="flex mt-1">
                        <input type="text" id="profileUid" readonly class="flex-1 p-2 border border-gray-300 rounded-l-lg bg-gray-100 text-sm overflow-ellipsis" onclick="this.select()">
                        <button id="copyUidBtn" class="bg-gray-300 text-gray-800 p-2 rounded-r-lg hover:bg-gray-400">Copy</button>
                    </div>
                </div>

                <div class="pt-4 flex justify-between">
                    <button id="profileSignOutBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Sign Out</button>
                    <button id="closeProfileModalBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Link to Firebase Config and Main Script -->
    <script src="firebase_config.js"></script>
    <script src="script.js"></script>
</body>
  </html>
